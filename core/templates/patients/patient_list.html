{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
    body {
        background: #eaf4ff; /* soft blue background like dashboard */
    }

    .page-title-box {
        background: white;
        padding: 20px 30px;
        border-radius: 20px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.08);
        margin-bottom: 25px;
        border-left: 8px solid #0077ff;
    }

    .page-title {
        font-size: 28px;
        font-weight: 700;
        color: #003c71;
        margin: 0;
    }

    .add-btn {
        background-color: #0aa06e;
        color: white;
        padding: 10px 22px;
        font-weight: 600;
        border-radius: 40px;
        font-size: 17px;
    }

    .add-btn:hover {
        background-color: #078d60;
        color: #fff;
    }

    .table-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.08);
        padding: 20px;
    }

    thead {
        background: #d8ecff;
        border-radius: 16px;
    }

    thead th {
        padding: 15px;
        color: #003c71;
        font-weight: 600;
        font-size: 15px;
    }

    tbody td {
        padding: 14px;
        font-size: 15px;
        color: #333;
    }

    tbody tr:hover {
        background: #f2f8ff;
        transition: 0.3s ease-in-out;
    }

    /* Buttons */
    .btn-view { background: #7e44ff; color: white; border-radius: 30px; padding: 6px 18px; font-size: 14px; }
    .btn-edit { background: #0077ff; color: white; border-radius: 30px; padding: 6px 18px; font-size: 14px; }
    .btn-delete { background: #ff3b3b; color: white; border-radius: 30px; padding: 6px 18px; font-size: 14px; }

    .btn-view:hover { background: #6d34e7; }
    .btn-edit:hover { background: #005fcc; }
    .btn-delete:hover { background: #d91919; }
</style>

<div class="container mt-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center page-title-box">
        <h2 class="page-title"><i class="bi bi-people-fill"></i> Patients</h2>

        <a href="{% url 'core:patient_create' %}" class="btn add-btn">
            <i class="bi bi-person-plus"></i> Add Patient
        </a>
    </div>

    <!-- TABLE -->
    <div class="table-card">
        {% if patients %}
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Phone</th>

                    {# --- CHANGE 1: Show Doctor column only for doctor login --- #}
                    {% if request.user.is_doctor %}
                        <th>Doctor</th>
                    {% endif %}

                    <th class="text-center">Actions</th>
                </tr>
            </thead>

            <tbody>
                {% for patient in patients %}
                <tr>
                    <td>{{ forloop.counter }}</td>

                    <td class="fw-semibold">
                        {{ patient.user.get_full_name }}
                    </td>

                    <td>{{ patient.phone }}</td>

                    {# --- CHANGE 2: Show doctor info only for doctor login --- #}
                    {% if request.user.is_doctor %}
                    <td>
                        {% if patient.doctor %}
                        <span class="badge bg-info text-dark">
                            {{ patient.doctor.user.get_full_name }}
                        </span>
                        {% else %}
                        <span class="text-muted">â€”</span>
                        {% endif %}
                    </td>
                    {% endif %}

                    <td class="text-center">
                        <a href="{% url 'core:patient_profile' patient.id %}" class="btn btn-view">View</a>
                        <a href="{% url 'core:patient_edit' patient.id %}" class="btn btn-edit">Edit</a>

                        <a href="{% url 'core:patient_delete' patient.id %}"
                           onclick="return confirm('Are you sure you want to delete this patient?');"
                           class="btn btn-delete">
                           Delete
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
        {% else %}
        <div class="alert alert-info text-center">
            No patients found.
        </div>
        {% endif %}
    </div>

</div>

{% endblock %}
